---
- name: BCDV Lab4 - Verification & Testing
  hosts: azure_vms
  gather_facts: yes
  
  tasks:
    - name: ğŸ” Test basic connectivity
      ping:
      register: connectivity_test
      
    - name: ğŸ“Š Gather system facts
      setup:
      register: system_facts
      
    - name: ğŸŒ Check nginx service status
      systemd:
        name: nginx
      register: nginx_status
      
    - name: ğŸ“„ Test web server response
      uri:
        url: "http://{{ ansible_host }}"
        method: GET
        return_content: yes
      register: web_response
      delegate_to: localhost
      
    - name: ğŸ“ˆ Check installed packages
      package_facts:
        manager: apt
      
    - name: âœ… Display verification results
      debug:
        msg: |
          
          ğŸ‰ BCDV Lab4 Verification Results:
          
          âœ… Connectivity: {{ 'PASS' if connectivity_test is succeeded else 'FAIL' }}
          âœ… System Info: {{ ansible_hostname }} ({{ ansible_distribution }} {{ ansible_distribution_version }})
          âœ… Nginx Status: {{ 'RUNNING' if nginx_status.status.ActiveState == 'active' else 'STOPPED' }}
          âœ… Web Server: {{ 'ACCESSIBLE' if web_response.status == 200 else 'NOT ACCESSIBLE' }}
          âœ… IP Address: {{ ansible_default_ipv4.address }}
          âœ… Memory: {{ ansible_memtotal_mb }}MB
          âœ… CPU Cores: {{ ansible_processor_vcpus }}
          âœ… Packages Installed: {{ ansible_pkg_mgr | default('apt') }}
          
          ğŸ“¦ Key Installed Software:
          {% for pkg in ['git', 'nginx', 'nodejs', 'python3-pip', 'curl', 'vim', 'htop'] %}
          - {{ pkg }}: {{ 'INSTALLED' if pkg in ansible_facts.packages else 'NOT FOUND' }}
          {% endfor %}
          
          ğŸŒ Web Server URL: http://{{ ansible_host }}
          ğŸ”— SSH Command: ssh {{ ansible_user }}@{{ ansible_host }}
          
          ğŸ“ˆ Lab Status: COMPLETED SUCCESSFULLY! ğŸš€
